using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using SB_UTILS;

namespace VIN_LIB
{
    public class VINService
    {
        private readonly List<char> _ALPHABET = new List<char>() {'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'J', 'K', 'L', 'M', 'N', 'P', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'};
        private const int _CONTROL_SUM_POSITION = 8;
        private const int _VIS_YEAR_POSITION = 9;
        private const int _VIN_LENGTH = 17;

        private readonly Dictionary<char, int> _CHAR_VALUES = new Dictionary<char, int>()
        {
            {'A', 1},
            {'B', 2},
            {'C', 3},
            {'D', 4},
            {'E', 5},
            {'F', 6},
            {'G', 7},
            {'H', 8},
            {'J', 1},
            {'K', 2},
            {'L', 3},
            {'M', 4},
            {'N', 5},
            {'P', 7},
            {'R', 9},
            {'S', 2},
            {'T', 3},
            {'U', 4},
            {'V', 5},
            {'W', 6},
            {'X', 7},
            {'Y', 8},
            {'Z', 9}
        };

        private readonly Dictionary<string, string> _WMI_DATA = new Dictionary<string, string>()
        {
            {"AB", "ЮАР"},
            {"AA", "ЮАР"},
            {"AC", "ЮАР"},
            {"AD", "ЮАР"},
            {"AE", "ЮАР"},
            {"AF", "ЮАР"},
            {"AG", "ЮАР"},
            {"AH", "ЮАР"},
            {"AJ", "Кот-д’Ивуар"},
            {"AK", "Кот-д’Ивуар"},
            {"AL", "Кот-д’Ивуар"},
            {"AM", "Кот-д’Ивуар"},
            {"AN", "Кот-д’Ивуар"},
            {"AP", "не используется"},
            {"AR", "не используется"},
            {"AS", "не используется"},
            {"AT", "не используется"},
            {"AU", "не используется"},
            {"AV", "не используется"},
            {"AW", "не используется"},
            {"AX", "не используется"},
            {"AY", "не используется"},
            {"AZ", "не используется"},
            {"A1", "не используется"},
            {"A2", "не используется"},
            {"A3", "не используется"},
            {"A4", "не используется"},
            {"A5", "не используется"},
            {"A6", "не используется"},
            {"A7", "не используется"},
            {"A8", "не используется"},
            {"A9", "не используется"},
            {"A0", "не используется"},
            {"BA", "Ангола"},
            {"BB", "Ангола"},
            {"BC", "Ангола"},
            {"BD", "Ангола"},
            {"BE", "Ангола"},
            {"BF", "Кения"},
            {"BG", "Кения"},
            {"BH", "Кения"},
            {"BJ", "Кения"},
            {"BK", "Кения"},
            {"BL", "Танзания"},
            {"BM", "Танзания"},
            {"BN", "Танзания"},
            {"BP", "Танзания"},
            {"BR", "Танзания"},
            {"BS", "не используется"},
            {"BT", "не используется"},
            {"BU", "не используется"},
            {"BV", "не используется"},
            {"BW", "не используется"},
            {"BX", "не используется"},
            {"BY", "не используется"},
            {"BZ", "не используется"},
            {"B1", "не используется"},
            {"B2", "не используется"},
            {"B3", "не используется"},
            {"B4", "не используется"},
            {"B5", "не используется"},
            {"B6", "не используется"},
            {"B7", "не используется"},
            {"B8", "не используется"},
            {"B9", "не используется"},
            {"B0", "не используется"},
            {"CA", "Бенин"},
            {"CB", "Бенин"},
            {"CC", "Бенин"},
            {"CD", "Бенин"},
            {"CE", "Бенин"},
            {"CF", "Мадагаскар"},
            {"CG", "Мадагаскар"},
            {"CH", "Мадагаскар"},
            {"CJ", "Мадагаскар"},
            {"CK", "Мадагаскар"},
            {"CL", "Тунис"},
            {"CM", "Тунис"},
            {"CN", "Тунис"},
            {"CP", "Тунис"},
            {"CR", "Тунис"},
            {"CS", "не используется"},
            {"CT", "не используется"},
            {"CU", "не используется"},
            {"CV", "не используется"},
            {"CW", "не используется"},
            {"CX", "не используется"},
            {"CY", "не используется"},
            {"CZ", "не используется"},
            {"C1", "не используется"},
            {"C2", "не используется"},
            {"C3", "не используется"},
            {"C4", "не используется"},
            {"C5", "не используется"},
            {"C6", "не используется"},
            {"C7", "не используется"},
            {"C8", "не используется"},
            {"C9", "не используется"},
            {"C0", "не используется"},
            {"DA", "Египет"},
            {"DB", "Египет"},
            {"DC", "Египет"},
            {"DD", "Египет"},
            {"DE", "Египет"},
            {"DF", "Марокко"},
            {"DG", "Марокко"},
            {"DH", "Марокко"},
            {"DJ", "Марокко"},
            {"DK", "Марокко"},
            {"DL", "Замбия"},
            {"DM", "Замбия"},
            {"DN", "Замбия"},
            {"DP", "Замбия"},
            {"DR", "Замбия"},
            {"DS", "не используется"},
            {"DT", "не используется"},
            {"DU", "не используется"},
            {"DV", "не используется"},
            {"DW", "не используется"},
            {"DX", "не используется"},
            {"DY", "не используется"},
            {"DZ", "не используется"},
            {"D1", "не используется"},
            {"D2", "не используется"},
            {"D3", "не используется"},
            {"D4", "не используется"},
            {"D5", "не используется"},
            {"D6", "не используется"},
            {"D7", "не используется"},
            {"D8", "не используется"},
            {"D9", "не используется"},
            {"D0", "не используется"},
            {"EA", "Эфиопия"},
            {"EB", "Эфиопия"},
            {"EC", "Эфиопия"},
            {"ED", "Эфиопия"},
            {"EE", "Эфиопия"},
            {"EF", "Мозамбик"},
            {"EG", "Мозамбик"},
            {"EH", "Мозамбик"},
            {"EJ", "Мозамбик"},
            {"EK", "Мозамбик"},
            {"EL", "не используется"},
            {"EM", "не используется"},
            {"EN", "не используется"},
            {"EP", "не используется"},
            {"ER", "не используется"},
            {"ES", "не используется"},
            {"ET", "не используется"},
            {"EU", "не используется"},
            {"EV", "не используется"},
            {"EW", "не используется"},
            {"EX", "не используется"},
            {"EY", "не используется"},
            {"EZ", "не используется"},
            {"E1", "не используется"},
            {"E2", "не используется"},
            {"E3", "не используется"},
            {"E4", "не используется"},
            {"E5", "не используется"},
            {"E6", "не используется"},
            {"E7", "не используется"},
            {"E8", "не используется"},
            {"E9", "не используется"},
            {"E0", "не используется"},
            {"FA", "Гана"},
            {"FB", "Гана"},
            {"FC", "Гана"},
            {"FD", "Гана"},
            {"FE", "Гана"},
            {"FF", "Нигерия"},
            {"FG", "Нигерия"},
            {"FH", "Нигерия"},
            {"FJ", "Нигерия"},
            {"FK", "Нигерия"},
            {"FL", "не используется"},
            {"FM", "не используется"},
            {"FN", "не используется"},
            {"FP", "не используется"},
            {"FR", "не используется"},
            {"FS", "не используется"},
            {"FT", "не используется"},
            {"FU", "не используется"},
            {"FV", "не используется"},
            {"FW", "не используется"},
            {"FX", "не используется"},
            {"FY", "не используется"},
            {"FZ", "не используется"},
            {"F1", "не используется"},
            {"F2", "не используется"},
            {"F3", "не используется"},
            {"F4", "не используется"},
            {"F5", "не используется"},
            {"F6", "не используется"},
            {"F7", "не используется"},
            {"F8", "не используется"},
            {"F9", "не используется"},
            {"F0", "не используется"},
            {"GA", "не используется"},
            {"GB", "не используется"},
            {"GC", "не используется"},
            {"GD", "не используется"},
            {"GE", "не используется"},
            {"GF", "не используется"},
            {"GG", "не используется"},
            {"GH", "не используется"},
            {"GJ", "не используется"},
            {"GK", "не используется"},
            {"GL", "не используется"},
            {"GM", "не используется"},
            {"GN", "не используется"},
            {"GP", "не используется"},
            {"GR", "не используется"},
            {"GS", "не используется"},
            {"GT", "не используется"},
            {"GU", "не используется"},
            {"GV", "не используется"},
            {"GW", "не используется"},
            {"GX", "не используется"},
            {"GY", "не используется"},
            {"GZ", "не используется"},
            {"G1", "не используется"},
            {"G2", "не используется"},
            {"G3", "не используется"},
            {"G4", "не используется"},
            {"G5", "не используется"},
            {"G6", "не используется"},
            {"G7", "не используется"},
            {"G8", "не используется"},
            {"G9", "не используется"},
            {"G0", "не используется"},
            {"HA", "не используется"},
            {"HB", "не используется"},
            {"HC", "не используется"},
            {"HD", "не используется"},
            {"HE", "не используется"},
            {"HF", "не используется"},
            {"HG", "не используется"},
            {"HH", "не используется"},
            {"HJ", "не используется"},
            {"HK", "не используется"},
            {"HL", "не используется"},
            {"HM", "не используется"},
            {"HN", "не используется"},
            {"HP", "не используется"},
            {"HR", "не используется"},
            {"HS", "не используется"},
            {"HT", "не используется"},
            {"HU", "не используется"},
            {"HV", "не используется"},
            {"HW", "не используется"},
            {"HX", "не используется"},
            {"HY", "не используется"},
            {"HZ", "не используется"},
            {"H1", "не используется"},
            {"H2", "не используется"},
            {"H3", "не используется"},
            {"H4", "не используется"},
            {"H5", "не используется"},
            {"H6", "не используется"},
            {"H7", "не используется"},
            {"H8", "не используется"},
            {"H9", "не используется"},
            {"H0", "не используется"},
            {"JA", "Япония"},
            {"JB", "Япония"},
            {"JC", "Япония"},
            {"JD", "Япония"},
            {"JE", "Япония"},
            {"JF", "Япония"},
            {"JG", "Япония"},
            {"JH", "Япония"},
            {"JJ", "Япония"},
            {"JK", "Япония"},
            {"JL", "Япония"},
            {"JM", "Япония"},
            {"JN", "Япония"},
            {"JP", "Япония"},
            {"JR", "Япония"},
            {"JS", "Япония"},
            {"JT", "Япония"},
            {"KA", "Шри Ланка"},
            {"KB", "Шри Ланка"},
            {"KC", "Шри Ланка"},
            {"KD", "Шри Ланка"},
            {"KE", "Шри Ланка"},
            {"KF", "Израиль"},
            {"KG", "Израиль"},
            {"KH", "Израиль"},
            {"KJ", "Израиль"},
            {"KK", "Израиль"},
            {"KL", "Южная Корея"},
            {"KM", "Южная Корея"},
            {"KN", "Южная Корея"},
            {"KP", "Южная Корея"},
            {"KR", "Южная Корея"},
            {"KS", "Казахстан"},
            {"KT", "Казахстан"},
            {"KU", "Казахстан"},
            {"KV", "Казахстан"},
            {"KW", "Казахстан"},
            {"KX", "Казахстан"},
            {"KY", "Казахстан"},
            {"KZ", "Казахстан"},
            {"K1", "Казахстан"},
            {"K2", "Казахстан"},
            {"K3", "Казахстан"},
            {"K4", "Казахстан"},
            {"K5", "Казахстан"},
            {"K6", "Казахстан"},
            {"K7", "Казахстан"},
            {"K8", "Казахстан"},
            {"K9", "Казахстан"},
            {"K0", "Казахстан"},
            {"LA", "Китай"},
            {"LB", "Китай"},
            {"LC", "Китай"},
            {"LD", "Китай"},
            {"LE", "Китай"},
            {"LF", "Китай"},
            {"LG", "Китай"},
            {"LH", "Китай"},
            {"LJ", "Китай"},
            {"LK", "Китай"},
            {"LL", "Китай"},
            {"LM", "Китай"},
            {"LN", "Китай"},
            {"LP", "Китай"},
            {"LR", "Китай"},
            {"LS", "Китай"},
            {"LT", "Китай"},
            {"LU", "Китай"},
            {"LV", "Китай"},
            {"LW", "Китай"},
            {"LX", "Китай"},
            {"LY", "Китай"},
            {"LZ", "Китай"},
            {"L1", "Китай"},
            {"L2", "Китай"},
            {"L3", "Китай"},
            {"L4", "Китай"},
            {"L5", "Китай"},
            {"L6", "Китай"},
            {"L7", "Китай"},
            {"L8", "Китай"},
            {"L9", "Китай"},
            {"L0", "Китай"},
            {"MA", "Индия"},
            {"MB", "Индия"},
            {"MC", "Индия"},
            {"MD", "Индия"},
            {"ME", "Индия"},
            {"MF", "Индонезия"},
            {"MG", "Индонезия"},
            {"MH", "Индонезия"},
            {"MJ", "Индонезия"},
            {"MK", "Индонезия"},
            {"ML", "Таиланд"},
            {"MM", "Таиланд"},
            {"MN", "Таиланд"},
            {"MP", "Таиланд"},
            {"MR", "Таиланд"},
            {"MS", "не используется"},
            {"MT", "не используется"},
            {"MU", "не используется"},
            {"MV", "не используется"},
            {"MW", "не используется"},
            {"MX", "не используется"},
            {"MY", "не используется"},
            {"MZ", "не используется"},
            {"M1", "не используется"},
            {"M2", "не используется"},
            {"M3", "не используется"},
            {"M4", "не используется"},
            {"M5", "не используется"},
            {"M6", "не используется"},
            {"M7", "не используется"},
            {"M8", "не используется"},
            {"M9", "не используется"},
            {"M0", "не используется"},
            {"NF", "Пакистан"},
            {"NG", "Пакистан"},
            {"NH", "Пакистан"},
            {"NJ", "Пакистан"},
            {"NK", "Пакистан"},
            {"NL", "Турция"},
            {"NM", "Турция"},
            {"NN", "Турция"},
            {"NP", "Турция"},
            {"NR", "Турция"},
            {"NT", "не используется"},
            {"NU", "не используется"},
            {"NV", "не используется"},
            {"NW", "не используется"},
            {"NX", "не используется"},
            {"NY", "не используется"},
            {"NZ", "не используется"},
            {"N1", "не используется"},
            {"N2", "не используется"},
            {"N3", "не используется"},
            {"N4", "не используется"},
            {"N5", "не используется"},
            {"N6", "не используется"},
            {"N7", "не используется"},
            {"N8", "не используется"},
            {"N9", "не используется"},
            {"N0", "не используется"},
            {"PA", "Филиппины"},
            {"PB", "Филиппины"},
            {"PC", "Филиппины"},
            {"PD", "Филиппины"},
            {"PE", "Филиппины"},
            {"PF", "Сингапур"},
            {"PG", "Сингапур"},
            {"PH", "Сингапур"},
            {"PJ", "Сингапур"},
            {"PK", "Сингапур"},
            {"PL", "Малайзия"},
            {"PM", "Малайзия"},
            {"PN", "Малайзия"},
            {"PP", "Малайзия"},
            {"PR", "Малайзия"},
            {"PS", "не используется"},
            {"PT", "не используется"},
            {"PU", "не используется"},
            {"PV", "не используется"},
            {"PW", "не используется"},
            {"PX", "не используется"},
            {"PY", "не используется"},
            {"PZ", "не используется"},
            {"P1", "не используется"},
            {"P2", "не используется"},
            {"P3", "не используется"},
            {"P4", "не используется"},
            {"P5", "не используется"},
            {"P6", "не используется"},
            {"P7", "не используется"},
            {"P8", "не используется"},
            {"P9", "не используется"},
            {"P0", "не используется"},
            {"RA", "ОАЭ"},
            {"RB", "ОАЭ"},
            {"RC", "ОАЭ"},
            {"RD", "ОАЭ"},
            {"RE", "ОАЭ"},
            {"RF", "Тайвань"},
            {"RG", "Тайвань"},
            {"RH", "Тайвань"},
            {"RJ", "Тайвань"},
            {"RK", "Тайвань"},
            {"RL", "Вьетнам"},
            {"RM", "Вьетнам"},
            {"RN", "Вьетнам"},
            {"RP", "Вьетнам"},
            {"RR", "Вьетнам"},
            {"RS", "Саудовская Аравия"},
            {"RT", "Саудовская Аравия"},
            {"RU", "Саудовская Аравия"},
            {"RV", "Саудовская Аравия"},
            {"RW", "Саудовская Аравия"},
            {"RX", "Саудовская Аравия"},
            {"RY", "Саудовская Аравия"},
            {"RZ", "Саудовская Аравия"},
            {"R1", "Саудовская Аравия"},
            {"R2", "Саудовская Аравия"},
            {"R3", "Саудовская Аравия"},
            {"R4", "Саудовская Аравия"},
            {"R5", "Саудовская Аравия"},
            {"R6", "Саудовская Аравия"},
            {"R7", "Саудовская Аравия"},
            {"R8", "Саудовская Аравия"},
            {"R9", "Саудовская Аравия"},
            {"R0", "Саудовская Аравия"},
            {"SA", "Великобритания"},
            {"SB", "Великобритания"},
            {"SC", "Великобритания"},
            {"SD", "Великобритания"},
            {"SE", "Великобритания"},
            {"SF", "Великобритания"},
            {"SG", "Великобритания"},
            {"SH", "Великобритания"},
            {"SJ", "Великобритания"},
            {"SK", "Великобритания"},
            {"SL", "Великобритания"},
            {"SM", "Великобритания"},
            {"SN", "Германия"},
            {"SP", "Германия"},
            {"SR", "Германия"},
            {"SS", "Германия"},
            {"ST", "Германия"},
            {"SU", "Польша"},
            {"SV", "Польша"},
            {"SW", "Польша"},
            {"SX", "Польша"},
            {"SY", "Польша"},
            {"SZ", "Польша"},
            {"S1", "Латвия"},
            {"S2", "Латвия"},
            {"S3", "Латвия"},
            {"S4", "Латвия"},
            {"TA", "Швейцария"},
            {"TB", "Швейцария"},
            {"TC", "Швейцария"},
            {"TD", "Швейцария"},
            {"TE", "Швейцария"},
            {"TF", "Швейцария"},
            {"TG", "Швейцария"},
            {"TH", "Швейцария"},
            {"TJ", "Чехия"},
            {"TK", "Чехия"},
            {"TL", "Чехия"},
            {"TM", "Чехия"},
            {"TN", "Чехия"},
            {"TP", "Чехия"},
            {"TR", "Венгрия"},
            {"TS", "Венгрия"},
            {"TT", "Венгрия"},
            {"TU", "Венгрия"},
            {"TV", "Венгрия"},
            {"TW", "Португалия"},
            {"TX", "Португалия"},
            {"TY", "Португалия"},
            {"TZ", "Португалия"},
            {"T1", "Португалия"},
            {"T2", "не используется"},
            {"T3", "не используется"},
            {"T4", "не используется"},
            {"T5", "не используется"},
            {"T6", "не используется"},
            {"T7", "не используется"},
            {"T8", "не используется"},
            {"T9", "не используется"},
            {"T0", "не используется"},
            {"UA", "не используется"},
            {"UB", "не используется"},
            {"UC", "не используется"},
            {"UD", "не используется"},
            {"UE", "не используется"},
            {"UF", "не используется"},
            {"UG", "не используется"},
            {"UH", "Дания"},
            {"UJ", "Дания"},
            {"UK", "Дания"},
            {"UL", "Дания"},
            {"UM", "Дания"},
            {"UN", "Ирландия"},
            {"UP", "Ирландия"},
            {"UR", "Ирландия"},
            {"US", "Ирландия"},
            {"UT", "Ирландия"},
            {"UU", "Румыния"},
            {"UV", "Румыния"},
            {"UW", "Румыния"},
            {"UX", "Румыния"},
            {"UY", "Румыния"},
            {"UZ", "Румыния"},
            {"U1", "не используется"},
            {"U2", "не используется"},
            {"U3", "не используется"},
            {"U4", "не используется"},
            {"U5", "Словакия"},
            {"U6", "Словакия"},
            {"U7", "Словакия"},
            {"U8", "не используется"},
            {"U9", "не используется"},
            {"U0", "не используется"},
            {"VA", "Австрия"},
            {"VB", "Австрия"},
            {"VC", "Австрия"},
            {"VD", "Австрия"},
            {"VE", "Австрия"},
            {"VF", "Франция"},
            {"VG", "Франция"},
            {"VH", "Франция"},
            {"VJ", "Франция"},
            {"VK", "Франция"},
            {"VL", "Франция"},
            {"VM", "Франция"},
            {"VN", "Франция"},
            {"VP", "Франция"},
            {"VR", "Франция"},
            {"VS", "Испания"},
            {"VT", "Испания"},
            {"VU", "Испания"},
            {"VV", "Испания"},
            {"VW", "Испания"},
            {"VX", "Сербия"},
            {"VY", "Сербия"},
            {"VZ", "Сербия"},
            {"V1", "Сербия"},
            {"V2", "Сербия"},
            {"V3", "Хорватия"},
            {"V4", "Хорватия"},
            {"V5", "Хорватия"},
            {"V6", "Эстония"},
            {"V7", "Эстония"},
            {"V8", "Эстония"},
            {"V9", "Эстония"},
            {"V0", "Эстония"},
            {"WA", "Германия"},
            {"WB", "Германия"},
            {"WC", "Германия"},
            {"WD", "Германия"},
            {"WE", "Германия"},
            {"WF", "Германия"},
            {"WG", "Германия"},
            {"WH", "Германия"},
            {"WJ", "Германия"},
            {"WK", "Германия"},
            {"WL", "Германия"},
            {"WM", "Германия"},
            {"WN", "Германия"},
            {"WP", "Германия"},
            {"WR", "Германия"},
            {"WS", "Германия"},
            {"WT", "Германия"},
            {"WU", "Германия"},
            {"WV", "Германия"},
            {"WW", "Германия"},
            {"WX", "Германия"},
            {"WY", "Германия"},
            {"WZ", "Германия"},
            {"W1", "Германия"},
            {"W2", "Германия"},
            {"W3", "Германия"},
            {"W4", "Германия"},
            {"W5", "Германия"},
            {"W6", "Германия"},
            {"W7", "Германия"},
            {"W8", "Германия"},
            {"W9", "Германия"},
            {"W0", "Германия"},
            {"XA", "Болгария"},
            {"XB", "Болгария"},
            {"XC", "Болгария"},
            {"XD", "Болгария"},
            {"XE", "Болгария"},
            {"XF", "Греция"},
            {"XG", "Греция"},
            {"XH", "Греция"},
            {"XJ", "Греция"},
            {"XK", "Греция"},
            {"XL", "Нидерланды"},
            {"XM", "Нидерланды"},
            {"XN", "Нидерланды"},
            {"XP", "Нидерланды"},
            {"XR", "Нидерланды"},
            {"XS", "СССР/СНГ"},
            {"XT", "СССР/СНГ"},
            {"XU", "СССР/СНГ"},
            {"XV", "СССР/СНГ"},
            {"XW", "СССР/СНГ"},
            {"XX", "Люксембург"},
            {"XY", "Люксембург"},
            {"XZ", "Люксембург"},
            {"X1", "Люксембург"},
            {"X2", "Люксембург"},
            {"X3", "Россия"},
            {"X4", "Россия"},
            {"X5", "Россия"},
            {"X6", "Россия"},
            {"X7", "Россия"},
            {"X8", "Россия"},
            {"X9", "Россия"},
            {"X0", "Россия"},
            {"YA", "Бельгия"},
            {"YB", "Бельгия"},
            {"YC", "Бельгия"},
            {"YD", "Бельгия"},
            {"YE", "Бельгия"},
            {"YF", "Финляндия"},
            {"YG", "Финляндия"},
            {"YH", "Финляндия"},
            {"YJ", "Финляндия"},
            {"YK", "Финляндия"},
            {"YL", "Мальта"},
            {"YM", "Мальта"},
            {"YN", "Мальта"},
            {"YP", "Мальта"},
            {"YR", "Мальта"},
            {"YS", "Швеция"},
            {"YT", "Швеция"},
            {"YU", "Швеция"},
            {"YV", "Швеция"},
            {"YW", "Швеция"},
            {"YX", "Норвегия"},
            {"YY", "Норвегия"},
            {"YZ", "Норвегия"},
            {"Y1", "Норвегия"},
            {"Y2", "Норвегия"},
            {"Y3", "Беларусь"},
            {"Y4", "Беларусь"},
            {"Y5", "Беларусь"},
            {"Y6", "Украина"},
            {"Y7", "Украина"},
            {"Y8", "Украина"},
            {"Y9", "Украина"},
            {"Y0", "Украина"},
            {"ZA", "Италия"},
            {"ZB", "Италия"},
            {"ZC", "Италия"},
            {"ZD", "Италия"},
            {"ZE", "Италия"},
            {"ZF", "Италия"},
            {"ZG", "Италия"},
            {"ZH", "Италия"},
            {"ZJ", "Италия"},
            {"ZK", "Италия"},
            {"ZL", "Италия"},
            {"ZM", "Италия"},
            {"ZN", "Италия"},
            {"ZP", "Италия"},
            {"ZR", "Италия"},
            {"ZS", "не используется"},
            {"ZT", "не используется"},
            {"ZU", "не используется"},
            {"ZV", "не используется"},
            {"ZW", "не используется"},
            {"ZX", "Словения"},
            {"ZY", "Словения"},
            {"ZZ", "Словения"},
            {"Z1", "Словения"},
            {"Z2", "Словения"},
            {"Z3", "Литва"},
            {"Z4", "Литва"},
            {"Z5", "Литва"},
            {"Z6", "Россия"},
            {"Z7", "Россия"},
            {"Z8", "Россия"},
            {"Z9", "Россия"},
            {"Z0", "Россия"},
            {"1A", "США"},
            {"1B", "США"},
            {"1C", "США"},
            {"1D", "США"},
            {"1E", "США"},
            {"1F", "США"},
            {"1G", "США"},
            {"1H", "США"},
            {"1J", "США"},
            {"1K", "США"},
            {"1L", "США"},
            {"1M", "США"},
            {"1N", "США"},
            {"1P", "США"},
            {"1R", "США"},
            {"1S", "США"},
            {"1T", "США"},
            {"1U", "США"},
            {"1V", "США"},
            {"1W", "США"},
            {"1X", "США"},
            {"1Y", "США"},
            {"1Z", "США"},
            {"11", "США"},
            {"12", "США"},
            {"13", "США"},
            {"14", "США"},
            {"15", "США"},
            {"16", "США"},
            {"17", "США"},
            {"18", "США"},
            {"19", "США"},
            {"10", "США"},
            {"2A", "Канада"},
            {"2B", "Канада"},
            {"2C", "Канада"},
            {"2D", "Канада"},
            {"2E", "Канада"},
            {"2F", "Канада"},
            {"2G", "Канада"},
            {"2H", "Канада"},
            {"2J", "Канада"},
            {"2K", "Канада"},
            {"2L", "Канада"},
            {"2M", "Канада"},
            {"2N", "Канада"},
            {"2P", "Канада"},
            {"2R", "Канада"},
            {"2S", "Канада"},
            {"2T", "Канада"},
            {"2U", "Канада"},
            {"2V", "Канада"},
            {"2W", "Канада"},
            {"2X", "Канада"},
            {"2Y", "Канада"},
            {"2Z", "Канада"},
            {"21", "Канада"},
            {"22", "Канада"},
            {"23", "Канада"},
            {"24", "Канада"},
            {"25", "Канада"},
            {"26", "Канада"},
            {"27", "Канада"},
            {"28", "Канада"},
            {"29", "Канада"},
            {"20", "Канада"},
            {"3A", "Мексика"},
            {"3B", "Мексика"},
            {"3C", "Мексика"},
            {"3D", "Мексика"},
            {"3E", "Мексика"},
            {"3F", "Мексика"},
            {"3G", "Мексика"},
            {"3H", "Мексика"},
            {"3J", "Мексика"},
            {"3K", "Мексика"},
            {"3L", "Мексика"},
            {"3M", "Мексика"},
            {"3N", "Мексика"},
            {"3P", "Мексика"},
            {"3R", "Мексика"},
            {"3S", "Мексика"},
            {"3T", "Мексика"},
            {"3U", "Мексика"},
            {"3V", "Мексика"},
            {"3W", "Мексика"},
            {"3X", "Коста Рика"},
            {"3Y", "Коста Рика"},
            {"3Z", "Коста Рика"},
            {"31", "Коста Рика"},
            {"32", "Коста Рика"},
            {"33", "Коста Рика"},
            {"34", "Коста Рика"},
            {"35", "Коста Рика"},
            {"36", "Коста Рика"},
            {"37", "Коста Рика"},
            {"38", "Каймановы острова"},
            {"39", "Каймановы острова"},
            {"30", "Каймановы острова"},
            {"4A", "США"},
            {"4B", "США"},
            {"4C", "США"},
            {"4D", "США"},
            {"4E", "США"},
            {"4F", "США"},
            {"4G", "США"},
            {"4H", "США"},
            {"4J", "США"},
            {"4K", "США"},
            {"4L", "США"},
            {"4M", "США"},
            {"4N", "США"},
            {"4P", "США"},
            {"4R", "США"},
            {"4S", "США"},
            {"4T", "США"},
            {"4U", "США"},
            {"4V", "США"},
            {"4W", "США"},
            {"4X", "США"},
            {"4Y", "США"},
            {"4Z", "США"},
            {"41", "США"},
            {"42", "США"},
            {"43", "США"},
            {"44", "США"},
            {"45", "США"},
            {"46", "США"},
            {"47", "США"},
            {"48", "США"},
            {"49", "США"},
            {"40", "США"},
            {"5A", "США"},
            {"5B", "США"},
            {"5C", "США"},
            {"5D", "США"},
            {"5E", "США"},
            {"5F", "США"},
            {"5G", "США"},
            {"5H", "США"},
            {"5J", "США"},
            {"5K", "США"},
            {"5L", "США"},
            {"5M", "США"},
            {"5N", "США"},
            {"5P", "США"},
            {"5R", "США"},
            {"5S", "США"},
            {"5T", "США"},
            {"5U", "США"},
            {"5V", "США"},
            {"5W", "США"},
            {"5X", "США"},
            {"5Y", "США"},
            {"5Z", "США"},
            {"51", "США"},
            {"52", "США"},
            {"53", "США"},
            {"54", "США"},
            {"55", "США"},
            {"56", "США"},
            {"57", "США"},
            {"58", "США"},
            {"59", "США"},
            {"50", "США"},
            {"6A", "Австралия"},
            {"6B", "Австралия"},
            {"6C", "Австралия"},
            {"6D", "Австралия"},
            {"6E", "Австралия"},
            {"6F", "Австралия"},
            {"6G", "Австралия"},
            {"6H", "Австралия"},
            {"6J", "Австралия"},
            {"6K", "Австралия"},
            {"6L", "Австралия"},
            {"6M", "Австралия"},
            {"6N", "Австралия"},
            {"6P", "Австралия"},
            {"6R", "Австралия"},
            {"6S", "Австралия"},
            {"6T", "Австралия"},
            {"6U", "Австралия"},
            {"6V", "Австралия"},
            {"6W", "Австралия"},
            {"6X", "не используется"},
            {"6Y", "не используется"},
            {"6Z", "не используется"},
            {"61", "не используется"},
            {"62", "не используется"},
            {"63", "не используется"},
            {"64", "не используется"},
            {"65", "не используется"},
            {"66", "не используется"},
            {"67", "не используется"},
            {"68", "не используется"},
            {"69", "не используется"},
            {"60", "не используется"},
            {"7A", "Новая Зеландия"},
            {"7B", "Новая Зеландия"},
            {"7C", "Новая Зеландия"},
            {"7D", "Новая Зеландия"},
            {"7E", "Новая Зеландия"},
            {"7F", "не используется"},
            {"7G", "не используется"},
            {"7H", "не используется"},
            {"7J", "не используется"},
            {"7K", "не используется"},
            {"7L", "не используется"},
            {"7M", "не используется"},
            {"7N", "не используется"},
            {"7P", "не используется"},
            {"7R", "не используется"},
            {"7S", "не используется"},
            {"7T", "не используется"},
            {"7U", "не используется"},
            {"7V", "не используется"},
            {"7W", "не используется"},
            {"7X", "не используется"},
            {"7Y", "не используется"},
            {"7Z", "не используется"},
            {"71", "не используется"},
            {"72", "не используется"},
            {"73", "не используется"},
            {"74", "не используется"},
            {"75", "не используется"},
            {"76", "не используется"},
            {"77", "не используется"},
            {"78", "не используется"},
            {"79", "не используется"},
            {"70", "не используется"},
            {"8A", "Аргентина"},
            {"8B", "Аргентина"},
            {"8C", "Аргентина"},
            {"8D", "Аргентина"},
            {"8E", "Аргентина"},
            {"8F", "Чили"},
            {"8G", "Чили"},
            {"8H", "Чили"},
            {"8J", "Чили"},
            {"8K", "Чили"},
            {"8L", "Эквадор"},
            {"8M", "Эквадор"},
            {"8N", "Эквадор"},
            {"8P", "Эквадор"},
            {"8R", "Эквадор"},
            {"8S", "Перу"},
            {"8T", "Перу"},
            {"8U", "Перу"},
            {"8V", "Перу"},
            {"8W", "Перу"},
            {"8X", "Венесуэла"},
            {"8Y", "Венесуэла"},
            {"8Z", "Венесуэла"},
            {"81", "Венесуэла"},
            {"82", "Венесуэла"},
            {"83", "не используется"},
            {"84", "не используется"},
            {"85", "не используется"},
            {"86", "не используется"},
            {"87", "не используется"},
            {"88", "не используется"},
            {"89", "не используется"},
            {"80", "не используется"},
            {"9A", "Бразилия"},
            {"9B", "Бразилия"},
            {"9C", "Бразилия"},
            {"9D", "Бразилия"},
            {"9E", "Бразилия"},
            {"9F", "Колумбия"},
            {"9G", "Колумбия"},
            {"9H", "Колумбия"},
            {"9J", "Колумбия"},
            {"9K", "Колумбия"},
            {"9L", "Парагвай"},
            {"9M", "Парагвай"},
            {"9N", "Парагвай"},
            {"9P", "Парагвай"},
            {"9R", "Парагвай"},
            {"9S", "Уругвай"},
            {"9T", "Уругвай"},
            {"9U", "Уругвай"},
            {"9V", "Уругвай"},
            {"9W", "Уругвай"},
            {"9X", "Тринидад и Тобаго"},
            {"9Y", "Тринидад и Тобаго"},
            {"9Z", "Тринидад и Тобаго"},
            {"91", "Тринидад и Тобаго"},
            {"92", "Тринидад и Тобаго"},
            {"93", "Бразилия"},
            {"94", "Бразилия"},
            {"95", "Бразилия"},
            {"96", "Бразилия"},
            {"97", "Бразилия"},
            {"98", "Бразилия"},
            {"99", "Бразилия"},
            {"90", "не используется"},
        };

        private readonly Dictionary<char, List<int>> _VIS_YEAR_DATA = new Dictionary<char, List<int>>()
        {
            { 'A', new List<int>() { 1980,2010 } },
            { 'L', new List<int>() { 1990,2020 } },
            { 'Y', new List<int>() { 2000,2030 } },
            { 'B', new List<int>() { 1981,2011 } },
            { 'M', new List<int>() { 1991,2021 } },
            { '1', new List<int>() { 2001,2031 } },
            { 'C', new List<int>() { 1982,2012 } },
            { 'N', new List<int>() { 1992,2022 } },
            { '2', new List<int>() { 2002,2032 } },
            { 'D', new List<int>() { 1983,2013 } },
            { 'P', new List<int>() { 1993,2023 } },
            { '3', new List<int>() { 2003,2033 } },
            { 'E', new List<int>() { 1984,2014 } },
            { 'R', new List<int>() { 1994,2024 } },
            { '4', new List<int>() { 2004,2034 } },
            { 'F', new List<int>() { 1985,2015 } },
            { 'S', new List<int>() { 1995,2025 } },
            { '5', new List<int>() { 2005,2035 } },
            { 'G', new List<int>() { 1986,2016 } },
            { 'T', new List<int>() { 1996,2026 } },
            { '6', new List<int>() { 2006,2036 } },
            { 'H', new List<int>() { 1987,2017 } },
            { 'V', new List<int>() { 1997,2027 } },
            { '7', new List<int>() { 2007,2037 } },
            { 'J', new List<int>() { 1988,2018 } },
            { 'W', new List<int>() { 1998,2028 } },
            { '8', new List<int>() { 2008,2038 } },
            { 'K', new List<int>() { 1989,2019 } },
            { 'X', new List<int>() { 1999,2029 } },
            { '9', new List<int>() { 2009,2039 } }
        };

        private readonly int?[] _WEIGHTS = new int?[] { 8, 7, 6, 5, 4, 3, 2, 10, null, 9, 8, 7, 6, 5, 4, 3, 2 };

        /// <summary>
        /// данный метод проверяет переданный VIN номер и возвращает true или false в зависимости от правильности VIN номера. 
        /// VIN номер должен удовлетворять всем требованиям, а также у него должна сходиться контрольная сумма.
        /// </summary>
        public bool CheckVIN(string vin) 
        {
            if (vin.Length != _VIN_LENGTH)
            {
                return false;
            }
            if (Funcs.All(Funcs.Map(x => _ALPHABET.Contains(x), vin)) == false)
            {
                return false;
            }
            var n = Funcs.Map(GetIntEquivalent, vin).ToList();

            var weights = Funcs.Filter(x => x != null, Funcs.Map(x => MulNullInt(x.Item1, x.Item2), Funcs.Zip(n, _WEIGHTS)));
            var m = (int) weights.Sum();

            var CHK = m - (Math.Floor(m / 11d) * 11);

            if (CHK == 10)
            {
                return vin[_CONTROL_SUM_POSITION] == 'X';
            }
            else
            {
                return vin[_CONTROL_SUM_POSITION] == char.Parse(CHK.ToString());
            }
        }

        /// <summary>
        /// данный метод возвращает страну, в которой было изготовлено транспортное средство. 
        /// </summary>
        /// <param name="vin">ВИН номер транспортного средства</param>
        /// <returns>Страна, в которой было изготовлено транспортное средство</returns>
        public string GetVINCountry(string vin)
        {
            var wmi = vin.Substring(0, 2);
            return _WMI_DATA[wmi];
        }

        /// <summary>
        /// данный метод возвращает год, в который было выпущено транспортное средство.
        /// </summary>
        /// <param name="vin">ВИН номер транспортного средства</param>
        /// <returns>Год, в который было выпущено транспортное средство</returns>
        public int GetTransportYear(string vin)
        {
            var years = Funcs.Filter((x) => x <= DateTime.Now.Year, _VIS_YEAR_DATA[vin[_VIS_YEAR_POSITION]]);
            return years.Max();
        }

        private int GetIntEquivalent(char c)
        {
            if (char.IsDigit(c) == true)
            {
                return int.Parse(c.ToString());
            }
            return _CHAR_VALUES[c];
        }

        private int? MulNullInt(int? a, int? b)
        {
            if (a == null)
            {
                return null;
            }
            if (b == null)
            {
                return null;
            }
            return a * b;
        }
    }
}
